<template>
    <div>
        <FacebookLoader :primaryOpacity="2" v-if="isLoading" :uniqueKey="'tweetspro'">
        </FacebookLoader>

        <div  v-if="tweets.total !== 0">
            <infinite-scroll :items="tweets" @fetch="fetchData">

              <tweets
                    @refresh="fetchData"
                    @like="like"
                    @dislike="dislike"
                     :tweets="tweets"
                     :userId="currentUser">

            </tweets>
             </infinite-scroll>

        </div>




            <div v-else-if="user && tweets.total === 0" class="container">
            <h1   class="text-gray-600 text-lg sm:text-3xl text-center">
                No tweets yet</h1>
            <div class="w-60 w-60 m-4 p-4">
                <svg  viewBox="0 0 511 99" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M50.0861 98.6039C77.2934 98.6039 99.3492 76.56 99.3492 49.3674C99.3492 22.1748 77.2934 0.130859 50.0861 0.130859C22.8789 0.130859 0.823029 22.1748 0.823029 49.3674C0.823029 76.56 22.8789 98.6039 50.0861 98.6039Z" fill="#47D5FE"/>
                    <path d="M307.702 14.6122H138.953V29.0935H307.702V14.6122Z" fill="#EDF2F7"/>
                    <path d="M510.841 49.3673H138.953V63.8487H510.841V49.3673Z" fill="#EDF2F7"/>
                    <path d="M510.841 84.1226H138.953V98.6039H510.841V84.1226Z" fill="#EDF2F7"/>
                </svg>
            </div>
        </div>

        <div v-else-if="tweets.total === 0"  class="flex flex-col w-full flex-col-reverse relative mb-10 sm:mb-0 ">
            <svg class="container h-64 sm:h-full w-full"
                 width="991" height="596"
                 viewBox="0 0 991 596" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0)">
                    <path d="M890.657 101.46H365.568V479.283H890.657V101.46Z" fill="#EDF2F7"/>
                    <path d="M990.847 462.49C990.847 472.431 982.788 480.49 972.847 480.49H382.36C372.419 480.49 364.36 472.431 364.36 462.49V25.3056C364.36 15.3645 372.419 7.30566 382.36 7.30566H972.847C982.788 7.30566 990.847 15.3645 990.847 25.3057V462.49ZM366.775 460.076C366.775 470.017 374.833 478.076 384.775 478.076H970.433C980.374 478.076 988.433 470.017 988.433 460.076V27.7199C988.433 17.7788 980.374 9.71991 970.433 9.71991H384.775C374.833 9.71991 366.775 17.7788 366.775 27.7199V460.076Z" fill="#B7DCF7"/>
                    <path d="M394.538 45.933C401.205 45.933 406.609 40.5286 406.609 33.8619C406.609 27.1953 401.205 21.7909 394.538 21.7909C387.871 21.7909 382.467 27.1953 382.467 33.8619C382.467 40.5286 387.871 45.933 394.538 45.933Z" fill="#47D5FE"/>
                    <path d="M428.337 45.933C435.004 45.933 440.408 40.5286 440.408 33.8619C440.408 27.1953 435.004 21.7909 428.337 21.7909C421.67 21.7909 416.266 27.1953 416.266 33.8619C416.266 40.5286 421.67 45.933 428.337 45.933Z" fill="#47D5FE"/>
                    <path d="M462.136 45.933C468.802 45.933 474.207 40.5286 474.207 33.8619C474.207 27.1953 468.802 21.7909 462.136 21.7909C455.469 21.7909 450.065 27.1953 450.065 33.8619C450.065 40.5286 455.469 45.933 462.136 45.933Z" fill="#47D5FE"/>
                    <path d="M756.912 160.503H499.312V163.397H756.912V160.503Z" fill="#3F3D56"/>
                    <path d="M756.912 180.764H499.312V183.658H756.912V180.764Z" fill="#3F3D56"/>
                    <path d="M756.912 201.024H499.312V203.919H756.912V201.024Z" fill="#3F3D56"/>
                    <path d="M756.912 242.586H499.312V245.48H756.912V242.586Z" fill="#3F3D56"/>
                    <path d="M756.912 262.847H499.312V265.741H756.912V262.847Z" fill="#3F3D56"/>
                    <path d="M756.912 283.107H499.312V286.002H756.912V283.107Z" fill="#3F3D56"/>
                    <path d="M627.737 461.176C615.084 461.176 602.715 457.424 592.194 450.395C581.673 443.365 573.473 433.373 568.631 421.683C563.789 409.993 562.522 397.129 564.99 384.719C567.459 372.309 573.552 360.909 582.499 351.962C591.447 343.015 602.846 336.921 615.256 334.453C627.667 331.984 640.53 333.251 652.22 338.093C663.91 342.936 673.902 351.136 680.932 361.657C687.962 372.177 691.714 384.547 691.714 397.2C691.695 414.162 684.948 430.423 672.955 442.417C660.961 454.411 644.699 461.157 627.737 461.176ZM627.737 335.638C615.562 335.638 603.659 339.248 593.535 346.013C583.411 352.777 575.521 362.392 570.861 373.641C566.202 384.89 564.983 397.268 567.358 409.21C569.734 421.152 575.597 432.121 584.206 440.731C592.816 449.341 603.785 455.204 615.727 457.579C627.669 459.955 640.047 458.736 651.296 454.076C662.545 449.417 672.16 441.526 678.925 431.402C685.689 421.278 689.3 409.376 689.3 397.2C689.281 380.878 682.789 365.231 671.248 353.689C659.707 342.148 644.059 335.656 627.737 335.638V335.638Z" fill="#47D5FE"/>
                    <path d="M659.122 394.786H630.152V365.815H625.323V394.786H596.353V399.614H625.323V428.585H630.152V399.614H659.122V394.786Z" fill="#47D5FE"/>
                    <path d="M445.343 351.33H27.472C17.5309 351.33 9.47205 359.389 9.47205 369.33V496.289C9.47205 506.23 17.5309 514.289 27.472 514.289H445.343C455.284 514.289 463.343 506.23 463.343 496.289V369.33C463.343 359.389 455.284 351.33 445.343 351.33Z" fill="#3F3D56"/>
                    <path d="M185.013 483.229C184.963 483.239 184.914 483.248 184.864 483.258C183.672 483.475 182.472 483.666 181.253 483.798C180.842 483.846 180.42 483.882 180.009 483.918C179.587 483.955 179.176 483.991 178.754 484.015C178.066 484.063 177.366 484.087 176.665 484.099C176.364 484.111 176.05 484.111 175.748 484.111H175.567C175.193 484.111 174.819 484.111 174.444 484.099C174.118 484.087 173.793 484.075 173.479 484.063C173.298 484.063 173.117 484.051 172.948 484.039C165.294 483.626 157.834 481.483 151.128 477.772C144.422 474.06 138.645 468.876 134.231 462.61C129.817 456.344 126.881 449.159 125.644 441.595C124.407 434.031 124.902 426.284 127.09 418.939C129.278 411.593 133.104 404.839 138.278 399.185C143.453 393.531 149.842 389.124 156.966 386.295C164.089 383.465 171.761 382.288 179.405 382.852C187.049 383.415 194.466 385.704 201.097 389.547C193.408 394.002 187.025 400.399 182.588 408.098C178.151 415.797 175.815 424.527 175.815 433.413C175.815 442.299 178.151 451.029 182.588 458.728C187.025 466.427 193.408 472.825 201.097 477.279C196.115 480.166 190.675 482.178 185.013 483.229V483.229Z" fill="#47D5FE"/>
                    <path d="M254.271 473.091C256.208 474.638 258.257 476.038 260.403 477.279C252.705 481.755 243.959 484.112 235.054 484.111H234.402C226.647 484.022 219.016 482.155 212.096 478.654C205.176 475.153 199.151 470.111 194.486 463.915C189.82 457.72 186.638 450.537 185.184 442.919C183.73 435.301 184.043 427.451 186.099 419.973C188.155 412.495 191.9 405.589 197.044 399.785C202.188 393.981 208.595 389.435 215.772 386.496C222.95 383.557 230.705 382.304 238.443 382.833C246.18 383.362 253.693 385.659 260.403 389.547C253.242 393.671 247.2 399.486 242.805 406.485C238.409 413.483 235.795 421.451 235.19 429.693C234.585 437.935 236.008 446.2 239.334 453.765C242.66 461.33 247.789 467.965 254.271 473.091V473.091Z" fill="#47D5FE"/>
                    <path d="M345.047 433.413C345.047 443.44 342.073 453.242 336.503 461.58C330.932 469.917 323.014 476.415 313.75 480.252C304.486 484.089 294.292 485.093 284.458 483.137C274.623 481.181 265.59 476.352 258.499 469.262C251.409 462.172 246.58 453.138 244.624 443.304C242.668 433.469 243.672 423.276 247.509 414.012C251.346 404.748 257.845 396.83 266.182 391.259C274.519 385.688 284.321 382.715 294.348 382.715C301.006 382.714 307.599 384.025 313.751 386.573C319.902 389.12 325.491 392.855 330.199 397.562C334.907 402.27 338.641 407.86 341.189 414.011C343.736 420.162 345.047 426.755 345.047 433.413Z" fill="#47D5FE"/>
                    <path d="M314.869 473.247C314.871 475.542 314.641 477.831 314.181 480.08C307.908 482.74 301.163 484.111 294.348 484.111C287.534 484.111 280.789 482.74 274.516 480.08C274.056 477.831 273.826 475.542 273.828 473.247C273.828 461.321 279.899 451.242 288.265 447.874C284.925 446.47 282.174 443.952 280.479 440.75C278.784 437.548 278.249 433.858 278.966 430.306C279.682 426.754 281.606 423.56 284.41 421.265C287.214 418.971 290.725 417.717 294.348 417.717C297.972 417.717 301.483 418.971 304.287 421.265C307.091 423.56 309.014 426.754 309.731 430.306C310.447 433.858 309.913 437.548 308.218 440.75C306.523 443.952 303.772 446.47 300.432 447.874C308.797 451.242 314.869 461.321 314.869 473.247Z" fill="white"/>
                    <path d="M254.271 473.091V473.247C254.102 476.092 253.698 478.919 253.064 481.697C247.162 484.208 241.198 484.027 234.402 484.111H233.751C226.935 484.12 220.189 482.748 213.918 480.08C213.869 479.873 213.833 479.663 213.809 479.452C213.418 477.407 213.224 475.329 213.23 473.247C213.23 461.321 219.302 451.242 227.667 447.874C224.327 446.47 221.576 443.953 219.881 440.751C218.186 437.549 217.652 433.859 218.368 430.308C219.085 426.756 221.008 423.562 223.812 421.268C226.616 418.974 230.128 417.72 233.751 417.721C234.979 417.717 236.203 417.863 237.396 418.155C234.311 427.944 234.273 438.438 237.287 448.248C240.301 458.059 246.224 466.722 254.271 473.091H254.271Z" fill="white"/>
                    <path d="M196.064 473.948C196.037 476.008 195.815 478.061 195.4 480.08C190.889 481.999 186.124 483.251 181.253 483.798C180.842 483.846 180.42 483.882 180.009 483.918C179.587 483.954 179.176 483.991 178.754 484.015C178.066 484.063 177.366 484.087 176.665 484.099C176.521 484.111 176.364 484.111 176.219 484.111H175.567C175.193 484.111 174.819 484.111 174.444 484.099C174.119 484.087 173.793 484.075 173.479 484.063C173.298 484.063 173.117 484.051 172.948 484.039C167.021 483.746 161.193 482.405 155.734 480.08C155.724 480.053 155.72 480.024 155.722 479.995C155.677 479.817 155.645 479.635 155.626 479.452C155.234 477.407 155.04 475.329 155.046 473.247C155.046 461.321 161.118 451.242 169.483 447.874C166.144 446.47 163.393 443.953 161.698 440.751C160.003 437.549 159.468 433.859 160.185 430.308C160.901 426.756 162.825 423.562 165.629 421.268C168.433 418.974 171.944 417.72 175.567 417.721C176.437 417.72 177.305 417.792 178.162 417.938C174.947 427.976 174.943 438.767 178.152 448.807C181.361 458.847 187.622 467.635 196.064 473.948H196.064Z" fill="white"/>
                </g>
                <defs>
                    <clipPath id="clip0">
                        <rect width="990.847" height="595.768" fill="white"/>
                    </clipPath>
                </defs>

            </svg>
                <h1
                class=" mt-16 sm:block transition translate-y-40 sm:translate-y-0 text-lg px-8 sm:transition-none absolute sm:text-4xl  my-8 -ml-4  sm:my-16 sm:w-1/3 sm:pl-10 sm:py-10  inset-0 text-gray-500  sm:p-2 ">
                <a href="/explore" class="text-blue-500 pr-2">Explore</a>other users and follow new friends</h1>
        </div>

    </div>

</template>

<script>
    import {FacebookLoader} from "vue-content-loader";

    export default {
        name: 'timeline',
        components: {
            FacebookLoader
        },
        props: {
            currentUser: {
                default: () => {
                }
            },
            userLikes: {
                required: true
            },
            user: {
                default: () => {
                }
            }
        },

        data: () => ({
            tweets: [],
            replyNumbers:{},
            liked: '',
            disliked: '',
            isLoading: false,
             lastPage: 1,
         }),

       async mounted() {
           this.isLoading=true;
            await this.fetchData(1);
           this.isLoading=false;
        },

        methods: {

           async fetchData(page) {
               if(page > this.lastPage) {return;}
                if (this.user) {
                    return await axios.get(`/profiles/${this.user.username}?page=${page}`).then((response) => {

                        this.tweets.push(...response.data.tweets.data);
                        this.lastPage = response.data.tweets.last_page;


                    }).catch(error => console.log(error))
                }

              await axios.get(`/tweets/tweetdata?page=${page}`).then(
                    response => {
                            this.tweets.push(...response.data.tweets.data);
                             this.lastPage = response.data.tweets.last_page;
                     }
                ).catch(error => console.error())

            },

            dislike(tweetID) {
                axios.delete(`/tweets/${tweetID}/like`).then(
                    (response) => {

                    }
                )
            },

            like(tweetID) {
                axios.post(`/tweets/${tweetID}/like`).then(
                    () => {

                    }
                ).catch(error => console.log(error));
            },
        }
    }
</script>
